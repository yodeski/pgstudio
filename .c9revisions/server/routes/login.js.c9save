{"ts":1353886683114,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var util = require('util');\nvar User = require('../models/modelUser');\n\nmodule.exports = function (app) {\n    app.get('/login', function(req, res) {\n        res.render('login', {\n            page: 'login'\n        });\n    });\n\n    app.post('/login', function (req, res) {\n        req.assert('inputUsername', 'Invalid postparam').notEmpty();\n        req.assert('inputPassword', 'Invalid getparam').notEmpty();\n        req.sanitize('inputUsername').toString();\n        req.sanitize('inputPassword').toString();\n    \n        var errors = req.validationErrors();\n        if (errors) {\n            res.send('There have been validation errors: ' + util.inspect(errors), 500);\n            return;\n        }\n\n        User.validateLogin (client, req.body.username, req.body.username, req.body.password, function (data) {\n            if (!data.error) {\n                console.log(data.obj);\n                if (data.obj && data.obj.active == true)\n                    res.redirect('/default', data);\n                else {\n                    res.send('usuario inexsistente o inactivo', 500);\n                }\n            }\n            else\n                res.send(data.error, 500);        \n        });\n\n\n    });\n    \n};\n"]],"start1":0,"start2":0,"length1":0,"length2":1213}]],"length":1213}
