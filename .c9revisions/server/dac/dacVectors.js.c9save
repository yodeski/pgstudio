{"ts":1353622822724,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1353623113699,"patch":[[{"diffs":[[1,"module.exports = {\n\n    getGeoJSONFromTable: function (client, bounds, tablename, fieldname, callback) {\n        client.on('drain', function(client){\n            client.end();\n        });\n        var data = {};\n        try {\n            var sql = 'select ST_AsGeoJSON(the_geom) as the_geom ';\n            sql = sql + 'from ' + tablename;\n            sql = sql + 'where the_geom && ST_GeogFromText(\\'SRID=4326;POLYGON((' + bounds._southWest.lng + ' ' + bounds._southWest.lat + ',' + bounds._northEast.lng + ' ' + bounds._southWest.lat + ',' + bounds._northEast.lng + ' ' + bounds._northEast.lat + ',' + bounds._southWest.lng + ' ' + bounds._northEast.lat + ',' + bounds._southWest.lng + ' ' + bounds._southWest.lat + '))\\') ';\n            sql = sql + 'and ST_Intersects(the_geom, ST_GeogFromText(\\'SRID=4326;POLYGON((' + bounds._southWest.lng + ' ' + bounds._southWest.lat + ',' + bounds._northEast.lng + ' ' + bounds._southWest.lat + ',' + bounds._northEast.lng + ' ' + bounds._northEast.lat + ',' + bounds._southWest.lng + ' ' + bounds._northEast.lat + ',' + bounds._southWest.lng + ' ' + bounds._southWest.lat + '))\\'));';\n\n            var query = client.query({\n                    text: sql\n                },\n                function (err, result) {\n                    callback(data = { rows: result.rows, error: err });\n                });\n\n            client.pauseDrain();\n        }\n        catch (e) {\n            callback( data = { rows: [], error: e });\n        }\n    }\n\n};"]],"start1":0,"start2":0,"length1":0,"length2":1484}]],"length":1484,"saved":false}
{"ts":1353623265656,"patch":[[{"diffs":[[0," }\n    }"],[1,",\n    // GeoJSON Feature Collection\n    FeatureCollection: function () {\n        this.type = 'FeatureCollection';\n        this.features = [];\n    }\n}"],[0,"\n\n};"]],"start1":1472,"start2":1472,"length1":12,"length2":161}]],"length":1633,"saved":false}
{"ts":1353623287492,"patch":[[{"diffs":[[0,", result) {\n"],[1,"                    \n"],[0,"            "]],"start1":1243,"start2":1243,"length1":24,"length2":45}]],"length":1654,"saved":false}
{"ts":1353623392979,"patch":[[{"diffs":[[0,", result) {\n"],[1,"                    var featureCollection = new FeatureCollection();\n                    for (i = 0; i < result.rows.length; i++)\n                    {\n                        featureCollection.features[i] = JSON.parse(result.rows[i].the_geom);\n                    }"],[0,"            "]],"start1":1243,"start2":1243,"length1":24,"length2":290},{"diffs":[[0,"{ rows: "],[-1,"result.rows"],[1,"featureCollection"],[0,", error:"]],"start1":1578,"start2":1578,"length1":27,"length2":33},{"diffs":[[0,"[];\n"],[1,""],[0,"    }"],[-1,"\n}"],[0,"\n\n};"]],"start1":1911,"start2":1911,"length1":15,"length2":13}]],"length":1924,"saved":false}
{"ts":1353624350373,"patch":[[{"diffs":[[0,"  },"],[-1,"\n    // GeoJSON Feature Collection\n    FeatureCollection: function () {\n        this.type = 'FeatureCollection';\n        this.features = [];\n    }"],[0,"\n\n};"]],"start1":1770,"start2":1770,"length1":154,"length2":8}]],"length":1778,"saved":false}
{"ts":1353624817342,"patch":[[{"diffs":[[0,") {\n"],[-1,"                    var featureCollection = new FeatureCollection();\n                    for (i = 0; i < result.rows.length; i++)\n                    {\n                        featureCollection.features[i] = JSON.parse(result.rows[i].the_geom);\n                    }                    \n"],[0,"    "]],"start1":1251,"start2":1251,"length1":295,"length2":8},{"diffs":[[0,"ws: "],[-1,"featureCollection"],[1,"result.rows"],[0,", er"]],"start1":1295,"start2":1295,"length1":25,"length2":19}]],"length":1485,"saved":false}
{"contributors":[],"silentsave":false,"ts":1353640209774,"patch":[[{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lng + ' ' + boun"]],"start1":423,"start2":423,"length1":33,"length2":32},{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lat + ',' + boun"]],"start1":452,"start2":452,"length1":33,"length2":32},{"diffs":[[0,"ounds._northEast"],[-1,"."],[0,"lng + ' ' + boun"]],"start1":481,"start2":481,"length1":33,"length2":32},{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lat + ',' + boun"]],"start1":510,"start2":510,"length1":33,"length2":32},{"diffs":[[0,"ounds._northEast"],[-1,"."],[0,"lng + ' ' + boun"]],"start1":539,"start2":539,"length1":33,"length2":32},{"diffs":[[0,"ounds._northEast"],[-1,"."],[0,"lat + ',' + boun"]],"start1":568,"start2":568,"length1":33,"length2":32},{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lng + ' ' + boun"]],"start1":597,"start2":597,"length1":33,"length2":32},{"diffs":[[0,"ounds._northEast"],[-1,"."],[0,"lat + ',' + boun"]],"start1":626,"start2":626,"length1":33,"length2":32},{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lng + ' ' + boun"]],"start1":655,"start2":655,"length1":33,"length2":32},{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lat + '))\\') ';\n"]],"start1":684,"start2":684,"length1":33,"length2":32},{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lng + ' ' + boun"]],"start1":811,"start2":811,"length1":33,"length2":32},{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lat + ',' + boun"]],"start1":840,"start2":840,"length1":33,"length2":32},{"diffs":[[0,"ounds._northEast"],[-1,"."],[0,"lng + ' ' + boun"]],"start1":869,"start2":869,"length1":33,"length2":32},{"diffs":[[0,"s._southWest"],[-1,"."],[0,"lat + ',' + "]],"start1":902,"start2":902,"length1":25,"length2":24},{"diffs":[[0,"orthEast"],[-1,"."],[0,"lng + ' "]],"start1":935,"start2":935,"length1":17,"length2":16},{"diffs":[[0,"ounds._northEast"],[-1,"."],[0,"lat + ',' + boun"]],"start1":956,"start2":956,"length1":33,"length2":32},{"diffs":[[0,"ounds._southWest"],[-1,"."],[0,"lng + ' ' + boun"]],"start1":985,"start2":985,"length1":33,"length2":32},{"diffs":[[0,"orthEast"],[-1,"."],[0,"lat + ',"]],"start1":1022,"start2":1022,"length1":17,"length2":16},{"diffs":[[0,"outhWest"],[-1,"."],[0,"lng + ' "]],"start1":1051,"start2":1051,"length1":17,"length2":16},{"diffs":[[0,"outhWest"],[-1,"."],[0,"lat + ')"]],"start1":1080,"start2":1080,"length1":17,"length2":16}]],"length":1465,"saved":false}
{"contributors":[],"silentsave":false,"ts":1353808635248,"patch":[[{"diffs":[[0,"            "],[1,"/*"],[0,"var sql = 's"]],"start1":225,"start2":225,"length1":24,"length2":26},{"diffs":[[0," + bounds._s"],[-1,"outhWestlng"],[1,"WLon"],[0," + ' ' + bou"]],"start1":421,"start2":421,"length1":35,"length2":28},{"diffs":[[0," + bounds._s"],[-1,"outhWestl"],[1,"WL"],[0,"at + ',' + b"]],"start1":443,"start2":443,"length1":33,"length2":26},{"diffs":[[0," + bounds._n"],[-1,"orthEastlng"],[1,"ELon"],[0," + ' ' + bou"]],"start1":465,"start2":465,"length1":35,"length2":28},{"diffs":[[0," + bounds._s"],[-1,"outhWestl"],[1,"WL"],[0,"at + ',' + b"]],"start1":487,"start2":487,"length1":33,"length2":26},{"diffs":[[0," + bounds._n"],[-1,"orthEastlng"],[1,"ELon"],[0," + ' ' + bou"]],"start1":509,"start2":509,"length1":35,"length2":28},{"diffs":[[0," + bounds._n"],[-1,"orthEastl"],[1,"EL"],[0,"at + ',' + b"]],"start1":531,"start2":531,"length1":33,"length2":26},{"diffs":[[0," + bounds._s"],[-1,"outhWestlng"],[1,"WLon"],[0," + ' ' + bou"]],"start1":553,"start2":553,"length1":35,"length2":28},{"diffs":[[0," + bounds._n"],[-1,"orthEastl"],[1,"EL"],[0,"at + ',' + b"]],"start1":575,"start2":575,"length1":33,"length2":26},{"diffs":[[0," + bounds._s"],[-1,"outhWestlng"],[1,"WLon"],[0," + ' ' + bou"]],"start1":597,"start2":597,"length1":35,"length2":28},{"diffs":[[0," + bounds._s"],[-1,"outhWestl"],[1,"WL"],[0,"at + '))\\') "]],"start1":619,"start2":619,"length1":33,"length2":26},{"diffs":[[0," + bounds._s"],[-1,"outhWestlng"],[1,"WLon"],[0," + ' ' + bou"]],"start1":739,"start2":739,"length1":35,"length2":28},{"diffs":[[0," + bounds._s"],[-1,"outhWestl"],[1,"WL"],[0,"at + ',' + b"]],"start1":761,"start2":761,"length1":33,"length2":26},{"diffs":[[0," + bounds._n"],[-1,"orthEastlng"],[1,"ELon"],[0," + ' ' + bou"]],"start1":783,"start2":783,"length1":35,"length2":28},{"diffs":[[0," + bounds._s"],[-1,"outhWestl"],[1,"WL"],[0,"at + ',' + b"]],"start1":805,"start2":805,"length1":33,"length2":26},{"diffs":[[0,"s._n"],[-1,"orthEastlng"],[1,"ELon"],[0," + '"]],"start1":835,"start2":835,"length1":19,"length2":12},{"diffs":[[0," + bounds._n"],[-1,"orthEastl"],[1,"EL"],[0,"at + ',' + b"]],"start1":849,"start2":849,"length1":33,"length2":26},{"diffs":[[0," + bounds._s"],[-1,"outhWestlng"],[1,"WLon"],[0," + ' ' + bou"]],"start1":871,"start2":871,"length1":35,"length2":28},{"diffs":[[0,"s._n"],[-1,"orthEastl"],[1,"EL"],[0,"at +"]],"start1":901,"start2":901,"length1":17,"length2":10},{"diffs":[[0,"s._s"],[-1,"outhWestlng"],[1,"WLon"],[0," + '"]],"start1":923,"start2":923,"length1":19,"length2":12},{"diffs":[[0,"s._s"],[-1,"outhWestl"],[1,"WL"],[0,"at +"]],"start1":945,"start2":945,"length1":17,"length2":10},{"diffs":[[0,"\\'));';\n"],[1,"            console.log(sql);*/"],[0,"\n       "]],"start1":959,"start2":959,"length1":16,"length2":47},{"diffs":[[0,"    "],[-1,"    text: sql\n                },\n    "],[1,"text: \"SELECT * from pgstudio.getGeoJsonFromTable ($1, $2, $3, $4, $5, $6)\",\n                values: [tablename, fieldname, bounds._sWLon, bounds._sWLat, bounds._nELon, bounds._nELat]\n"],[0,"    "]],"start1":1050,"start2":1050,"length1":45,"length2":192},{"diffs":[[0,"        "],[1," },"],[0," functio"]],"start1":1241,"start2":1241,"length1":16,"length2":19},{"diffs":[[0,", result) {\n    "],[1,"            console.log(this);\n"],[0,"                "]],"start1":1266,"start2":1266,"length1":32,"length2":63},{"diffs":[[0,"            "],[-1,"    "],[0,"});\n\n       "]],"start1":1381,"start2":1381,"length1":28,"length2":24},{"diffs":[[0,"Drain();"],[1,"            "],[0,"\n       "]],"start1":1422,"start2":1422,"length1":16,"length2":28}]],"length":1547,"saved":false}
{"ts":1353808658894,"patch":[[{"diffs":[[0,"log("],[-1,"this"],[1,"query"],[0,");\n "]],"start1":1302,"start2":1302,"length1":12,"length2":13}]],"length":1548,"saved":false}
{"ts":1353809072774,"patch":[[{"diffs":[[0,") {\n"],[-1,"                console.log(query);\n"],[0,"    "]],"start1":1274,"start2":1274,"length1":44,"length2":8}]],"length":1512,"saved":false}
